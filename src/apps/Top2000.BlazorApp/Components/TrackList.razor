@using Top2000.BlazorApp.Services
@using Top2000.Features.AllListingsOfEdition
@inject TrackService TrackService

@if (_isLoading)
{
    <div class="text-center p-4">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading tracks...</span>
        </div>
        <p class="mt-2">Loading @Year tracks...</p>
    </div>
}
else if (_tracks.Count == 0)
{
    <div class="text-center p-4">
        <p class="text-muted">No tracks found for @Year</p>
    </div>
}
else
{
    <ul class="track-list">
        @foreach (var track in _tracks)
        {
            <li class="@(track.TrackId == SelectedTrack ? "selected" : "")"
                @onclick="() => OnSelect.InvokeAsync(track.TrackId)">
                #{track.Position} â€“ @track.Title by @track.Artist
            </li>
        }
    </ul>
}

@code {
    [Parameter] public int Year { get; set; }
    [Parameter] public int? SelectedTrack { get; set; }
    [Parameter] public EventCallback<int> OnSelect { get; set; }

    List<TrackListing> _tracks = [];
    bool _isLoading = false;

    protected override async Task OnParametersSetAsync()
    {
        _isLoading = true;
        try
        {
            _tracks = await TrackService.GetTracksAsync(Year);
        }
        finally
        {
            _isLoading = false;
            StateHasChanged();
        }
    }
}